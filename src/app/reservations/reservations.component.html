<section class="booking-section" *ngIf="!loading; else loadingTemplate">
  <h2 class="title header-row">
    <span>{{user.role}}: {{user.name}} - Reservations Dashboard</span>
    <button *ngIf="this.hasOpenRequests" class="right-section" (click)="goToRequests()" mat-flat-button color="primary">
      <mat-icon>history</mat-icon>
      Your Requests
    </button>
  </h2>

  <!-- Active Reservations -->
  <div>
    <h4 class="title"><mat-icon>dashboard</mat-icon> Active</h4>
    <div class="booking-list" *ngIf="activeReservations.length; else noActive">
      <button
        class="booking-card"
        *ngFor="let booking of activeReservations"
        (click)="openBooking(booking)"
      >
        <img [src]="getImagePath(booking.id)" [alt]="booking.propertyName" class="booking-image" />
        <div class="booking-details">
          <div class="hotel-name">{{ booking.propertyName }}</div>
          <div class="dates">
            {{ booking.checkInDate | date:'d MMM y' }} - {{ booking.checkOutDate | date:'d MMM y' }}
          </div>
          <div class="meta">
            <span>{{ booking.roomType | lowercase }}</span>
            <span>{{ booking.numberOfOccupants }} occupant(s)</span>
            <span>Room: {{ booking.roomNumber }}</span>
          </div>
        </div>
        <div class="status-badge status-checkedin">
          <span>Status: {{ booking.status | titlecase }}</span>
        </div>
      </button>
    </div>
    <ng-template #noActive><p class="empty">No active reservations.</p></ng-template>
  </div>

  <!-- Upcoming Reservations -->
  <div>
    <h4 class="title"><mat-icon>event</mat-icon> Upcoming</h4>
    <div class="booking-list" *ngIf="upcomingReservations.length; else noUpcoming">
      <button
        class="booking-card"
        *ngFor="let booking of upcomingReservations"
        (click)="openBooking(booking)"
      >
        <img [src]="getImagePath(booking.id)" [alt]="booking.propertyName" class="booking-image" />
        <div class="booking-details">
          <div class="hotel-name">{{ booking.propertyName }}</div>
          <div class="dates">
            {{ booking.checkInDate | date:'d MMM y' }} - {{ booking.checkOutDate | date:'d MMM y' }}
          </div>
          <div class="meta">
            <span>{{ booking.roomType | lowercase }}</span>
            <span>{{ booking.numberOfOccupants }} occupant(s)</span>
            <span>Room: {{ booking.roomNumber }}</span>
          </div>
        </div>
        <div class="status-badge status-upcoming">
          <span>Status: {{ booking.status | titlecase }}</span>
        </div>
      </button>
    </div>
    <ng-template #noUpcoming><p class="empty">No upcoming reservations.</p></ng-template>
  </div>

  <!-- Past Reservations -->
  <div>
    <h4 class="title"><mat-icon>history</mat-icon> Past</h4>
    <div class="booking-list" *ngIf="pastReservations.length; else noPast">
      <button
        class="booking-card"
        *ngFor="let booking of pastReservations"
        (click)="openBooking(booking)"
      >
        <img [src]="getImagePath(booking.id)" [alt]="booking.propertyName" class="booking-image" />
        <div class="booking-details">
          <div class="hotel-name">{{ booking.propertyName }}</div>
          <div class="dates">
            {{ booking.checkInDate | date:'d MMM y' }} - {{ booking.checkOutDate | date:'d MMM y' }}
          </div>
          <div class="meta">
            <span>{{ booking.roomType | lowercase }}</span>
            <span>{{ booking.numberOfOccupants }} occupant(s)</span>
            <span>Room: {{ booking.roomNumber }}</span>
          </div>
        </div>
        <div
          class="status-badge"
          [ngClass]="{
            'status-completed': booking.status === 'COMPLETED' || booking.status === 'completed',
            'status-cancelled': booking.status === 'CANCELLED' || booking.status === 'cancelled'
          }"
        >
          <span>Status: {{ booking.status | titlecase }}</span>
        </div>
      </button>
    </div>
    <ng-template #noPast><p class="empty">No past reservations.</p></ng-template>
  </div>
</section>

<ng-template #loadingTemplate>
  <div class="loading">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>
</ng-template>
