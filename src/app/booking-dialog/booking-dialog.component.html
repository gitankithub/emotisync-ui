<div class="dialog-container">
  <!-- Close Icon -->
  <button class="close-icon" mat-icon-button (click)="close()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Full-width Image -->
  <div class="image-wrapper">
    <img [src]="data.imageUrl" alt="{{ data.propertyName }}" class="dialog-image" />
  </div>

  <!-- Content -->
  <div class="dialog-content">
    <h2>{{ data.propertyName }}</h2>

    <p class="details">
      {{ data.checkInDate | date: 'd MMMM y' }} ‚Äì
      {{ data.checkOutDate | date: 'd MMMM y' }}
    </p>

    <p class="details">
      {{ data.roomType }}
      ‚Ä¢ Room {{ data.roomNumber }}
      ‚Ä¢ {{ data.numberOfOccupants }} guest(s)
    </p>

    <p class="details">Status: {{ data.status | titlecase }}</p>

    <!-- Rating & Feedback -->
    <div class="rating-section"
      *ngIf="data.status === 'completed' || data.status === 'checkedin' || data.status === 'CHECKED_IN'">

      <h3>
        {{
          data.status === 'completed' || data.status === 'COMPLETED'
            ? 'We Value Your Feedback!'
            : 'We‚Äôd love your thoughts on your stay so far!'
        }}
      </h3>

      <div class="emoji-bar">
        <button *ngFor="let r of ratings"
                (click)="setRating(r.value)"
                [class.active]="r.value === selectedRating"
                [attr.aria-label]="r.label">
          {{ r.emoji }}
        </button>
      </div>

      <mat-form-field appearance="outline" class="feedback-field"
                      *ngIf="data.status === 'completed' || data.status === 'COMPLETED'">
        <mat-label>Feedback</mat-label>
        <textarea matInput [(ngModel)]="feedbackText"
                  placeholder="Please share your experience..."></textarea>
      </mat-form-field>
    </div>

    <!-- Feedback Response -->
    <p *ngIf="selectedRating >= 4 && data.status !== 'completed' && data.status !== 'COMPLETED'">
      Thank you for your feedback! üôè
    </p>

    <p *ngIf="(selectedRating ?? 0) < 4 && (selectedRating ?? 0) > 0
              && (data.status !== 'completed' && data.status !== 'COMPLETED')">
      We‚Äôre sorry for any inconvenience. Our team will assist you shortly.
      Please click help for further assistance.
    </p>

    <!-- Actions -->
    <div class="actions">
      <button *ngIf="data.status === 'completed' || data.status === 'checkedin' || data.status === 'CHECKED_IN'"
              mat-flat-button class="action-btn"
              (click)="submitFeedback()"
              [disabled]="!selectedRating && !feedbackText">
        Submit
      </button>

      <button *ngIf="data.status === 'upcoming' || data.status === 'checkedin' || data.status === 'CHECKED_IN'"
              mat-flat-button class="action-btn"
              (click)="redirectToHelp()">
        <mat-icon>chat</mat-icon>
        Help?
      </button>
    </div>
  </div>
</div>
