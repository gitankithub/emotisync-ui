<div class="dialog-container">
  <!-- Close Icon -->
  <button class="close-icon" mat-icon-button (click)="close()">
    <mat-icon>close</mat-icon>
  </button>

  <!-- Full-width Image -->
  <div class="image-wrapper">
    <img [src]="getImagePath(data.id)" alt="{{ data.propertyName }}" class="dialog-image" />
  </div>

  <!-- Content -->
  <div class="dialog-content">
    <h2>{{ data.propertyName }}</h2>

    <p class="details">
      {{ data.checkInDate | date: 'd MMMM y' }} –
      {{ data.checkOutDate | date: 'd MMMM y' }}
    </p>

    <p class="details">
      {{ data.roomType }}
      • Room {{ data.roomNumber }}
      • {{ data.numberOfOccupants }} guest(s)
    </p>

    <p class="details">Status: {{ data.status | titlecase }}</p>

    <!-- Rating & Feedback -->
    <div class="rating-section"
      *ngIf="data.status === 'COMPLETED' || data.status === 'CHECKED_IN'">

      <h3>
        {{
           data.status === 'CHECKED_IN' || data.status === 'COMPLETED'
            ? 'We Value Your Feedback!'
            : 'We’d love your thoughts on your stay so far!'
        }}
      </h3>

      <div class="emoji-bar">
        <button *ngFor="let r of ratings"
                (click)="setRating(r.value)"
                [class.active]="r.value === selectedRating"
                [attr.aria-label]="r.label">
          {{ r.emoji }}
        </button>
      </div>

      <mat-form-field appearance="outline" class="feedback-field"
                      *ngIf="data.status === 'COMPLETED'">
        <mat-label>Feedback</mat-label>
        <textarea matInput [(ngModel)]="feedbackText"
                  placeholder="Please share your experience..."></textarea>
      </mat-form-field>
    </div>&nbsp;

    <!-- Feedback Response -->
    <p *ngIf="data.status !== 'COMPLETED'">
      {{getDefaultFeedbackText(selectedRating)}}
    </p>

    <!-- Actions -->
    <div class="actions">
      <button *ngIf="selectedRating >= 4 || data.status === 'COMPLETED'"
              mat-flat-button class="action-btn"
              (click)="submitFeedback()"
              [disabled]="!selectedRating && !feedbackText">
        Submit
      </button>

      <button *ngIf="data.status === 'BOOKED' || data.status === 'CHECKED_IN'"
              mat-flat-button class="action-btn"
              (click)="redirectToHelp()">
        <mat-icon>chat</mat-icon>
        Help?
      </button>
      <app-chat *ngIf="isChatVisible" class="slide-in-chat" (closeChat)="closeMiniChat()"></app-chat>
    </div>
  </div>
</div>
